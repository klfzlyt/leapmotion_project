<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title></title>
		    <script src="//cdn.jsdelivr.net/phaser/2.4.4/phaser.min.js"></script>
			<script src="http://js.leapmotion.com/leap-0.6.3.min.js"></script>
			<script type="text/javascript" src="js/leap_frame.js" ></script>
			<script type="text/javascript" src="js/gesture.js" ></script>
	</head>
	<body>
		<div id="game"></div>
		<script>
		var signal;
		var instruction_index=0;
		
		
		
		
		
		var instruction_command=["up","down","left","right"];
		start_leap(function(frame){
			
			var ans=GetTheClockWiseGesture(frame);
			var swipeDirec=GetTheSwipeGesture(frame);
			if(swipteDirec.swipeDirection===instruction_command[instruction_index%4])
			{
				signal=true;
				instruction_index++;
			}
			console.log(ans);
			console.log(ans1);
		
		   	
		});
   
   
		</script>
		
		
		
		
		
		
		<script>			
		/*
		 * game frame
		 * 
		 * 
		 * 
		 */
var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'game', { preload: preload, create: create });

function preload() {
    game.load.audio('cannon', [ './cannon1.mp3']);

}
function create() {
	song = game.add.audio('cannon');
    song.allowMultiple = false;
	game.sound.setDecodedCallback([song], start, this);	
}
//
function start(){
	isstarted=true;
average_split_song(60,song,300);//cannon1.mp3的音乐长度 300S
}
var song;
var isplaying=false;
var isstarted=false;

function update(){
	if(isstarted){
		//1.如果当前有音乐在放，则不做任何操作，等待音乐放映结束，如果当前没有音乐在放，则可以接受播放命令
		if(isplaying){
			//等待音乐放映结束
		}
		else{
			if(signal){
				play_segment(instruction_index);
				isplaying=true;
			}
		}
	}
}

//segments -----numbers
//song     -----instance of Song ()
//total_time ---- s/unit
function average_split_song(segments,song,total_time){
	//song is instance of Song(phaser)
	var totaltime=total_time;
	var segment=totaltime/segments;
	//start from 0
	for(var i=0;i<segments;i++){
		song.addMarker(i.toString(),i*segment,segment);		
	}	
	song.onStop.add(soundStopped,this);
}

//index ---number from 0
function play_segment(index){
	song.play(index.toString());	
}
function soundStopped(song){
	
	console.log("song ended");
	isplaying=false;
}




		</script>
	</body>
</html>
